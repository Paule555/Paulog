<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Paulog</title>
<meta name="theme-color" content="#10B981">
<link rel="manifest" href="paulog-manifest.json">
<link rel="icon" href="paulog-icon-192.png">
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#0F172A;color:#E2E8F0}
.app{max-width:480px;margin:0 auto;padding-bottom:80px}
button{cursor:pointer}
.card{background:#1E293B;padding:16px;border-radius:10px;margin:12px}
.hdr{padding:20px;text-align:center}
.hdr h1{margin:0;font-size:28px}
.sec-btn{width:100%;padding:14px;margin:6px 0;background:#1E293B;border:1px solid #334155;border-radius:8px;color:#E2E8F0}
input{background:#0F172A;border:1px solid #334155;border-radius:6px;padding:6px;color:#E2E8F0}
.hidden{display:none}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
"use strict";

const DATA_KEY="paulog-data";
const PLAN_KEY="paulog-plan";

/* ================= PLAN ================= */

function defaultPlan(){
return{
meta:{globalSets:4},
days:{
"Push":{
muscles:"Brust / Schulter / Trizeps",
color:"#3B82F6",
exercises:[
"Bankdrücken","Schrägbankdrücken","Brustpresse","Butterfly",
"Kabelzug Brust","Frontdrücken","Seitheben","Butterfly Reverse",
"Nackenheben","Shruggs","Trizeps Kabel","Kabel über Kopf",
"Dips Maschine","Liegestütze","Dips","Handstand Pushups"
]},
"Pull":{
muscles:"Rücken / Bizeps",
color:"#10B981",
exercises:[
"Latzug","Frontziehen sitzend","Rudern","Low Row","Überzüge",
"Bicepscurls","Bicepscurls Kabel","Klimmzüge","Face Pull"
]},
"Legs":{
muscles:"Beine / Core",
color:"#F59E0B",
exercises:[
"Beinpresse","Beinstrecker","Beinstrecker frei","Beinbeuger",
"Waden","Kniebeugen","Rumänisches Kreuzheben",
"Bulgarian Split Squats","Hip Thrust","Glute Bridge",
"Hanging Leg Raises","Plank"
]}
}};
}

function loadPlan(){
let p=localStorage.getItem(PLAN_KEY);
if(p)return JSON.parse(p);
let d=defaultPlan();
localStorage.setItem(PLAN_KEY,JSON.stringify(d));
return d;
}
function savePlan(){localStorage.setItem(PLAN_KEY,JSON.stringify(PLAN));}

let PLAN=loadPlan();

/* ================= DATA ================= */

function loadData(){
let d=localStorage.getItem(DATA_KEY);
return d?JSON.parse(d):{};
}
function saveData(){localStorage.setItem(DATA_KEY,JSON.stringify(DATA));}

let DATA=loadData();

/* ================= STATE ================= */

let state={
view:"home",
day:null,
date:today(),
session:{}
};

function today(){return new Date().toISOString().split("T")[0];}
function esc(s){return String(s).replace(/[<>&"]/g,a=>({"<":"&lt;",">":"&gt;","&":"&amp;","\"":"&quot;"}[a]));}

/* ================= RENDER ================= */

function render(){
const app=document.getElementById("app");
if(state.view==="home")app.innerHTML=renderHome();
if(state.view==="track")app.innerHTML=renderTrack();
if(state.view==="plan")app.innerHTML=renderPlan();
bind();
}

/* ---------- HOME ---------- */

function renderHome(){
let h=`<div class="hdr"><h1>Pau<span style="color:#10B981">log</span></h1></div>`;
for(let d in PLAN.days){
let info=PLAN.days[d];
h+=`<div class="card" style="border-left:4px solid ${info.color}">
<h3>${d}</h3>
<p>${info.muscles}</p>
<button class="sec-btn" data-start="${d}">Training starten</button>
</div>`;
}
h+=`<div class="card">
<button class="sec-btn" data-view="plan">⚙️ Plan bearbeiten</button>
</div>`;
return h;
}

/* ---------- TRACK ---------- */

function initSession(day){
state.day=day;
state.session={};
let sets=PLAN.meta.globalSets;
PLAN.days[day].exercises.forEach(ex=>{
state.session[ex]=[];
for(let i=0;i<sets;i++){
state.session[ex].push({kg:"",reps:""});
}
});
}

function renderTrack(){
let info=PLAN.days[state.day];
let h=`<div class="card"><button data-view="home">← Zurück</button>
<h2>${state.day}</h2></div>`;
PLAN.days[state.day].exercises.forEach(ex=>{
h+=`<div class="card"><h4>${ex}</h4>`;
state.session[ex].forEach((s,i)=>{
h+=`Satz ${i+1}: 
<input type="number" data-ex="${esc(ex)}" data-i="${i}" data-f="kg" value="${s.kg}" placeholder="kg">
<input type="number" data-ex="${esc(ex)}" data-i="${i}" data-f="reps" value="${s.reps}" placeholder="Wdh"><br>`;
});
h+=`</div>`;
});
h+=`<div class="card"><button class="sec-btn" data-save>Speichern</button></div>`;
return h;
}

/* ---------- PLAN EDIT ---------- */

function renderPlan(){
let h=`<div class="card">
<button data-view="home">← Zurück</button>
<h2>Plan bearbeiten</h2>
<p>Globale Sätze:</p>
<input type="number" data-global value="${PLAN.meta.globalSets}">
</div>`;

for(let d in PLAN.days){
let day=PLAN.days[d];
h+=`<div class="card">
<h3>${d}</h3>
<p>${day.muscles}</p>`;
day.exercises.forEach(ex=>{
h+=`${ex} <button data-rem="${d}|${ex}">✕</button><br>`;
});
h+=`<button data-add="${d}">+ Übung</button>
</div>`;
}
return h;
}

/* ================= EVENTS ================= */

function bind(){
document.querySelectorAll("[data-view]").forEach(b=>{
b.onclick=()=>{state.view=b.dataset.view;render();};
});
document.querySelectorAll("[data-start]").forEach(b=>{
b.onclick=()=>{
initSession(b.dataset.start);
state.view="track";
render();
};
});
document.querySelectorAll("[data-save]").forEach(b=>{
b.onclick=()=>{
if(!DATA[state.day])DATA[state.day]=[];
DATA[state.day].push({date:today(),exercises:state.session});
saveData();
state.view="home";
render();
};
});
document.querySelectorAll("[data-ex]").forEach(inp=>{
inp.oninput=e=>{
let ex=inp.dataset.ex;
let i=inp.dataset.i;
let f=inp.dataset.f;
state.session[ex][i][f]=inp.value;
};
});
document.querySelectorAll("[data-global]").forEach(inp=>{
inp.oninput=()=>{
PLAN.meta.globalSets=parseInt(inp.value)||4;
savePlan();
};
});
document.querySelectorAll("[data-rem]").forEach(b=>{
b.onclick=()=>{
let [d,ex]=b.dataset.rem.split("|");
PLAN.days[d].exercises=PLAN.days[d].exercises.filter(e=>e!==ex);
savePlan();
render();
};
});
document.querySelectorAll("[data-add]").forEach(b=>{
b.onclick=()=>{
let name=prompt("Übungsname:");
if(name){
PLAN.days[b.dataset.add].exercises.push(name);
savePlan();
render();
}
};
});
}

/* ================= INIT ================= */

render();
</script>

<script>
if('serviceWorker'in navigator){
navigator.serviceWorker.register('paulog-sw.js');
}
</script>

</body>
</html>
